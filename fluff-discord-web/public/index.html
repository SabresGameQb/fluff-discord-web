<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fluff (Liar's Dice) Online</title>
<style>
  body {
    background: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  input, button {
    font-size: 1rem;
    padding: 8px;
    margin: 5px 0;
    border: none;
    border-radius: 4px;
  }
  input {
    width: 200px;
    background: #222;
    color: #eee;
  }
  button {
    background: #6200ee;
    color: white;
    cursor: pointer;
  }
  button:disabled {
    background: #444;
    cursor: not-allowed;
  }
  #gameArea {
    margin-top: 20px;
  }
  #log {
    background: #222;
    padding: 10px;
    height: 150px;
    overflow-y: scroll;
    border-radius: 4px;
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>Fluff (Liar's Dice) Online</h1>

<div id="joinArea">
  <input id="nameInput" type="text" placeholder="Your name" />
  <input id="roomInput" type="text" placeholder="Room ID" />
  <button id="joinBtn">Join Room</button>
</div>

<div id="gameArea" style="display:none;">
  <div>
    <strong>Players:</strong> <span id="players"></span>
  </div>
  <div>
    <strong>Your Dice:</strong> <span id="dice"></span>
  </div>
  <div>
    <input id="bidCount" type="number" min="1" placeholder="Count" />
    <input id="bidFace" type="number" min="1" max="6" placeholder="Face (1-6)" />
    <button id="placeBidBtn" disabled>Place Bid</button>
    <button id="callFluffBtn" disabled>Call Fluff</button>
  </div>
  <div id="status"></div>
  <div id="log"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const joinBtn = document.getElementById('joinBtn');
  const nameInput = document.getElementById('nameInput');
  const roomInput = document.getElementById('roomInput');
  const gameArea = document.getElementById('gameArea');
  const playersSpan = document.getElementById('players');
  const diceSpan = document.getElementById('dice');
  const bidCount = document.getElementById('bidCount');
  const bidFace = document.getElementById('bidFace');
  const placeBidBtn = document.getElementById('placeBidBtn');
  const callFluffBtn = document.getElementById('callFluffBtn');
  const status = document.getElementById('status');
  const log = document.getElementById('log');
  const joinArea = document.getElementById('joinArea');

  let mySocketId = null;

  joinBtn.onclick = () => {
    const name = nameInput.value.trim();
    const room = roomInput.value.trim();
    if (!room) {
      alert('Please enter a Room ID');
      return;
    }
    if (!name) {
      alert('Please enter your name');
      return;
    }
    socket.emit('joinRoom', { room, name });
  };

  socket.on('connect', () => {
    mySocketId = socket.id;
  });

  socket.on('joinedRoom', (room) => {
    joinArea.style.display = 'none';
    gameArea.style.display = 'block';
  });

  socket.on('updatePlayers', (players) => {
    playersSpan.textContent = players.join(', ');
  });

  socket.on('updateDice', (dice) => {
    diceSpan.textContent = dice.join(', ');
  });

  socket.on('updateBids', (bids) => {
    // Optional: display current bids
  });

  socket.on('log', (msg) => {
    log.innerHTML += `<div>${msg}</div>`;
    log.scrollTop = log.scrollHeight;
  });

  socket.on('errorMsg', (msg) => {
    alert(msg);
  });

  socket.on('currentTurn', (playerId) => {
    const isMyTurn = (playerId === mySocketId);
    placeBidBtn.disabled = !isMyTurn;
    callFluffBtn.disabled = !isMyTurn;
    status.textContent = isMyTurn ? "It's your turn!" : "Waiting for other players...";
  });

  placeBidBtn.onclick = () => {
    const count = parseInt(bidCount.value);
    const face = parseInt(bidFace.value);
    if (!count || !face || face < 1 || face > 6 || count < 1) {
      alert('Enter valid bid count and face (1-6)');
      return;
    }
    socket.emit('placeBid', { count, face });
    bidCount.value = '';
    bidFace.value = '';
  };

  callFluffBtn.onclick = () => {
    socket.emit('callFluff');
  };
</script>
</body>
</html>
